# Shared Hooks

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ö—É–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.

## useRealtimeCollection (V2)

–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Ö—É–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ SignalR. –í–∫–ª—é—á–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ ID.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîÑ **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** —á–µ—Ä–µ–∑ SignalR
- üéØ **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π TypeScript
- üîß **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —Å–æ–±—ã—Ç–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- üì¶ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è** —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- üéõÔ∏è **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º** (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ)
- üõ†Ô∏è **–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
- ‚ú® **–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ ID** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ ID
- üß© **Lodash –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Lodash –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- `initialItems: T[]` - –Ω–∞—á–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `options: RealtimeCollectionOptions<T, K>` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ö—É–∫–∞

#### RealtimeCollectionOptions

- `hubType: SignalRHubType` - —Ç–∏–ø SignalR —Ö–∞–±–∞
- `getItemId: (item: T) => K` - —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è ID —ç–ª–µ–º–µ–Ω—Ç–∞
- `events: RealtimeEvents` - –Ω–∞–∑–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π SignalR
- `fetchItem?: (id: K) => Promise<T>` - **[V2]** —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ ID
- `mapEventData?: (data: any) => T` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç SignalR
- `shouldAddItem?: (item: T) => boolean` - —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `updateItem?: (existing: T, updated: T) => T` - –∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `archiveField?: keyof T` - –ø–æ–ª–µ –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'isArchived')

#### –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (RealtimeCollectionResult)

| –°–≤–æ–π—Å—Ç–≤–æ/–ú–µ—Ç–æ–¥ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------|-----|----------|
| `items` | `Ref<T[]>` | –†–µ–∞–∫—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |
| `isConnected` | `Ref<boolean>` | –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SignalR |
| `error` | `Ref<Error \| null>` | –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å |
| `connect` | `() => Promise<void>` | –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ö–∞–±—É |
| `disconnect` | `() => Promise<void>` | –ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ—Ç —Ö–∞–±–∞ |
| `addItem` | `(item: T) => void` | –ú–µ—Ç–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é |
| `updateItem` | `(item: T) => void` | –ú–µ—Ç–æ–¥ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |
| `removeItem` | `(itemId: K) => void` | –ú–µ—Ç–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |
| `clear` | `() => void` | –ú–µ—Ç–æ–¥ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ |

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä —Å –¥–æ—Å–∫–∞–º–∏ (V2 —Å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–æ–π)

```typescript
import { useRealtimeCollection } from '@/shared/hooks'
import { SignalRHubType } from '@/shared/env'
import type { BoardDto } from '@/dataAccess/boards/models'
import { apiClient } from '@/dataAccess/shared'

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ—Å–∫–∏ –ø–æ ID
const fetchBoardById = async (boardId: string): Promise<BoardDto> => {
  return await apiClient.boards.getBoard(boardId)
}

const {
  items: boards,
  isConnected,
  error,
  connect,
  disconnect
} = useRealtimeCollection<BoardDto, string>([], {
  hubType: SignalRHubType.Boards,
  getItemId: (board) => board.id,
  events: {
    created: 'BoardCreated',
    updated: 'BoardUpdated',
    deleted: 'BoardDeleted',
    archived: 'BoardArchived'
  },
  fetchItem: fetchBoardById, // ‚ú® –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ ID
  shouldAddItem: (board) => !board.isArchived
})
```

### –ü—Ä–∏–º–µ—Ä —Å –∑–∞–¥–∞—á–∞–º–∏

```typescript
import { useRealtimeCollection } from '@/shared/hooks'
import { SignalRHubType } from '@/shared/env'
import type { TaskDto } from '@/dataAccess/tasks/models'
import { apiClient } from '@/dataAccess/shared'

const {
  items: tasks,
  isConnected,
  addItem,
  updateItem,
  removeItem
} = useRealtimeCollection<TaskDto, number>([], {
  hubType: SignalRHubType.Tasks,
  getItemId: (task) => task.id,
  events: {
    created: 'TaskCreated',
    updated: 'TaskUpdated',
    deleted: 'TaskDeleted'
  },
  fetchItem: (taskId) => apiClient.tasks.getTask(taskId), // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
  updateItem: (existing, updated) => ({
    ...updated,
    localModifications: existing.localModifications
  })
})
```

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ V2

### –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ ID

–ö–æ–≥–¥–∞ SignalR –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ —Å —Ç–æ–ª—å–∫–æ ID —ç–ª–µ–º–µ–Ω—Ç–∞, —Ö—É–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç:

```typescript
// SignalR –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: { id: "board-123" }
// –•—É–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç: fetchItem("board-123")
// –ò –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
```

### –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

- **–°–æ–∑–¥–∞–Ω–∏–µ/–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ –ø–æ–ª–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, —Ç–∞–∫ –∏ —Ç–æ–ª—å–∫–æ ID
- **–£–¥–∞–ª–µ–Ω–∏–µ**: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ ID –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≥–ª—É–±–æ–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Lodash –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å Lodash

- `findIndex` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `merge` - –≥–ª—É–±–æ–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
- `cloneDeep` - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- `isString`, `isNumber`, `isObject` - –Ω–∞–¥–µ–∂–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å SignalR —Ö–∞–±–æ–º
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–æ–π
4. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ** - –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

## –ü—Ä–∏–º–µ—Ä—ã

- `examples/RealtimeCollectionExample.vue` - –±–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä
- `examples/RealtimeCollectionV2Example.vue` - **–Ω–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä —Å V2 –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏**
- `examples/RealtimeChatExample.vue` - –ø—Ä–∏–º–µ—Ä –¥–ª—è —á–∞—Ç–∞